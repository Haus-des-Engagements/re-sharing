{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load tz %}

{% block content %}
  <div class="my-3">
    <nav class="breadcrumb-nav"  aria-label="breadcrumb">
      <ol class="breadcrumb rounded-3">
        <li class="breadcrumb-item">
          <a href="{% url "dashboards:users_bookings_and_permissions" %}">{% trans "My Dashboard" %}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url "bookings:list-recurrences" %}">{% trans "My recurring bookings" %}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ rrule.get_first_booking.title }}</li>
      </ol>
    </nav>
  </div>
  <h1 class="mt-4">
    {% trans "Recurring booking" %}: <em>{{ rrule.get_first_booking.title }}</em>
  </h1>
  <div class="card mb-3 mt-4">
    <div class="row g-0">
      <div class="col col-md-2 card-body text-center">
        <p class="h5">
          {{ rrule.first_occurrence_date }}
          <br />
          -
          <br />
          {% if rrule.last_occurrence_date %}
            {{ rrule.last_occurrence_date|date:"d.m.Y" }}
          {% else %}
            {% trans "(without end)" %}
          {% endif %}
        </p>
        <p class="h6">
          {{ rrule.get_first_booking.start_time|date:"H:i" }} - {{ rrule.get_first_booking.end_time|date:"H:i" }}
        </p>
      </div>
      <div class="col-md-7">
        <div class="card-body">
          <h5 class="card-title">{{ rrule.get_first_booking.title }}</h5>
          <p class="card-text">
            <svg width="1em" height="1em">
              <use href="#bi-door-closed" />
            </svg>
            <em>{{ rrule.get_first_booking.room }}</em>
            <br />
            <svg width="1em" height="1em">
              <use href="#bi-person-fill" />
            </svg>
            <em>{{ rrule.get_first_booking.user }}</em> {% trans "for" %}
            <em>{{ rrule.get_first_booking.organization }}</em>
            <br />
            {% trans "Occurrences" %}: {{ rrule.number_of_occurrences }}
          </p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card-body">
          <div class="d-grid gap-2">
            {% if is_cancelable %}
              <button id="cancel-button"
                      type="submit"
                      class="btn btn-outline-danger mb-3"
                      value="Submit"
                      hx-confirm="{% trans 'Are you sure you want to cancel all future bookings?' %}"
                      hx-patch="{% url 'bookings:cancel-rrule-bookings' rrule.uuid %}"
                      hx-target="body"
                      hx-swap="innerHTML">{% trans "Cancel all future bookings" %}</button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <svg width="1em" height="1em">
        <use href="#bi-arrow-repeat" />
      </svg>
      {{ rrule.get_first_booking.recurrence_rule.get_human_readable_rule }}
      <br />
    </div>
  </div>
  <div class="mt-4">
    <h5>{% trans "These bookings are part of the recurrence" %}:</h5>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">{% trans "Weekday" %}</th>
            <th scope="col">{% trans "Date" %}</th>
            <th scope="col">{% trans "Room" %}</th>
            <th scope="col">{% trans "Status" %}</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
            {% include "bookings/partials/occurrence_item.html" %}
          {% endfor %}
        </tbody>
      </table>
      {% if not rrule.last_occurrence_date %}
        {% trans "We will automatically generate the next occurrences two years in advance." %}
      {% endif %}
    </div>
  </div>
{% endblock content %}
