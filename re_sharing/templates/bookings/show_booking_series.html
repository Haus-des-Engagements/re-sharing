{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load tz %}

{% block content %}
  <div class="my-3">
    <nav class="breadcrumb-nav"  aria-label="breadcrumb">
      <ol class="breadcrumb rounded-3">
        <li class="breadcrumb-item">
          <a href="{% url "dashboards:users_bookings_and_permissions" %}">{% trans "My Dashboard" %}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url "bookings:list-booking-series" %}">{% trans "My booking series" %}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ booking_series.title }}</li>
      </ol>
    </nav>
  </div>
  <h1 class="mt-4">
    {% trans "Booking series" %}: <em>{{ booking_series.title }}</em>
  </h1>
  <div class="card mb-3 mt-4">
    <div class="row g-0">
      <div class="col col-md-2 card-body text-center">
        <p class="h5">
          {{ booking_series.first_booking_date }}
          <br />
          -
          <br />
          {% if booking_series.last_booking_date %}
            {{ booking_series.last_booking_date|date:"d.m.Y" }}
          {% else %}
            {% trans "(without end)" %}
          {% endif %}
        </p>
        <p class="h6">{{ booking_series.start_time|date:"H:i" }} - {{ booking_series.end_time|date:"H:i" }}</p>
      </div>
      <div class="col-md-7">
        <div class="card-body">
          <h5 class="card-title">{{ booking_series.title }}</h5>
          <p class="card-text">
            <svg width="1em" height="1em">
              <use href="#bi-door-closed" />
            </svg>
            <em>{{ booking_series.resource }}</em>
            <br />
            <svg width="1em" height="1em">
              <use href="#bi-person-fill" />
            </svg>
            <em>{{ booking_series.user }}</em> {% trans "for" %}
            <em>{{ booking_series.organization }}</em>
            <br />
            {% trans "Occurrences" %}: {{ booking_series.number_of_occurrences }}
          </p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card-body">
          <div class="d-grid gap-2">
            {% if is_cancelable %}
              <button id="cancel-button"
                      type="submit"
                      class="btn btn-outline-danger mb-3"
                      value="Submit"
                      hx-confirm="{% trans 'Are you sure you want to cancel all future bookings?' %}"
                      hx-patch="{% url 'bookings:cancel-booking-series-bookings' booking_series.uuid %}"
                      hx-target="body"
                      hx-swap="innerHTML">{% trans "Cancel all future bookings" %}</button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <svg width="1em" height="1em">
        <use href="#bi-arrow-repeat" />
      </svg>
      {{ booking_series.get_human_readable_rule }}
      <br />
    </div>
  </div>
  <div class="mt-4">
    <h5>{% trans "These bookings are part of the recurrence" %}:</h5>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">{% trans "Weekday" %}</th>
            <th scope="col">{% trans "Date" %}</th>
            <th scope="col">{% trans "Resource" %}</th>
            <th scope="col">{% trans "Status" %}</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
            {% include "bookings/partials/occurrence_item.html" %}
          {% endfor %}
        </tbody>
      </table>
      {% if not booking_series.last_booking_date %}
        {% trans "We will automatically generate the next bookings two years in advance." %}
      {% endif %}
    </div>
  </div>
{% endblock content %}
