{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load tz %}
{% load crispy_forms_tags %}
{% load admin_urls %}

{% block content %}
  <h1 class="mt-4">{% trans "Manage invoices" %}</h1>
  <form class="row gx-3 gy-2 align-items-center mt-3"
        action="{% url 'bookings:manager-list-invoices' %}"
        method="get"
        hx-get="{% url 'bookings:manager-list-invoices' %}"
        hx-target="#booking-list"
        hx-trigger="change"
        hx-sync="closest form:replace"
        hx-push-url="true"
        hx-indicator="#spinner">
    <div id="div_id_organization" class="col-3">
      <select name="organization" class="form-select" id="id_organization">
        <option selected value="all">{% trans "all organizations" %}</option>
        {% for organization in organizations %}
          <option value="{{ organization.slug }}">{{ organization }}</option>
        {% endfor %}
      </select>
    </div>
    <div id="div_id_resource" class="col-auto">
      <select name="resource" class="form-select" id="id_resource">
        <option selected value="all">{% trans "all resources" %}</option>
        {% for resource in resources %}<option value="{{ resource.slug }}">{{ resource }}</option>{% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="invoice_filter" class="form-select" id="id_invoice_filter">
        <option value="all">{% trans "with & without invoice number" %}</option>
        <option value="with_invoice">{% trans "only with invoice number" %}</option>
        <option value="without_invoice">{% trans "only without invoice number" %}</option>
      </select>
    </div>
    <div id="div_invoice_number" class="col-auto">
      <input type="text"
             name="invoice_number"
             class="form-control textinput"
             placeholder="{% trans 'Invoice number' %}"
             id="invoice_number"
             {% if invoice_number %}value="{{ invoice_number }}"{% endif %} />
    </div>
    <div id="spinner"
         class="spinner-border col-auto htmx-indicator"
         role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </form>
  <div id="booking-list">
    {% partialdef manager-list-invoices inline %}
    <div class="table-responsive mt-5">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">{% trans "Booking" %}</th>
            <th scope="col">{% trans "Timespan" %}</th>
            <th scope="col">{% trans "Resource" %}</th>
            <th scope="col">{% trans "Title" %}</th>
            <th scope="col">{% trans "Organization" %}</th>
            <th scope="col">{% trans "Total amount" %}</th>
            <th scope="col">{% trans "Invoice number" %}</th>
            <th scope="col">{% trans "Admin-Link" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
            <tr id="tr-{{ booking.slug }}">
              {% partialdef manager-invoice-item inline %}
              <td>{{ booking.timespan.lower|date:"l, d.m.Y" }}</td>
              <td>{{ booking.timespan.lower|date:"H:i" }} - {{ booking.timespan.upper|date:"H:i" }}</td>
              <td>{{ booking.resource }}</td>
              <td>
                <a href="{% url "bookings:show-booking" booking.slug %}">{{ booking.title }}</a>
              </td>
              <td>{{ booking.organization }}</td>
              <td>{{ booking.total_amount }}</td>
              <td>{{ booking.invoice_number }}</td>
              <td>
                <a href="{% url 'admin:bookings_booking_change' booking.pk %}">Edit</a>
              </td>
            {% endpartialdef %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endpartialdef %}
</div>
{% endblock content %}
