{% extends "base.html" %}

{% load static i18n %}

{% block title %}
  {% trans "HdE | Rooms" %}
{% endblock title %}
{% block content %}
  <h1 class="mt-4">{% trans "Rooms" %}</h1>
  <div class="col-auto">
    <svg class="fs-4 me-1" width="1em" height="1em">
      <use href="#bi-calendar4-week" />
    </svg>
    {% url 'resources:planner' as planner_url %}
    {% blocktrans %}You can also find free slots in the <a href="{{ planner_url }}">planner overview</a>.{% endblocktrans %}
  </div>
  <form class="row g-2 mt-2"
        hx-get="{% url 'resources:list-resources' %}"
        hx-target="#resource-list"
        hx-trigger="input change"
        hx-push-url="true"
        hx-indicator="#spinner">
    <div id="div_start_date" class="form-floating mb-3 col-auto">
      <input type="date"
             name="start_date"
             class="form-control"
             placeholder="{% trans 'Date' %}"
             id="start_date"
             value="{{ selected_date|default:'' }}" />
      <label for="start_date">{% trans "Date" %}</label>
    </div>
    <div id="div_start_time" class="form-floating mb-3 col-auto">
      <select name="start_time" class="form-select" id="start_time">
        <option value="">{% trans "Any time" %}</option>
        {% for option in time_options %}
          <option value="{{ option.value }}"
                  {% if selected_time == option.value %}selected{% endif %}>{{ option.label }}</option>
        {% endfor %}
      </select>
      <label for="start_time">{% trans "Time" %}</label>
    </div>
    <div id="div_duration" class="form-floating mb-3 col-auto">
      <select name="duration" class="form-select" id="duration">
        {% for option in duration_options %}
          <option value="{{ option.value }}"
                  {% if selected_duration == option.value %}selected{% endif %}>{{ option.label }}</option>
        {% endfor %}
      </select>
      <label for="duration">{% trans "Duration" %}</label>
    </div>
    <div id="div_persons_count" class="form-floating mb-3 col-auto">
      <input type="number"
             name="persons_count"
             class="form-control textinput"
             placeholder="{% trans 'Number of persons' %}"
             id="persons_count" />
      <label for="persons_count">{% trans "Number of persons" %}</label>
    </div>
    {% if locations.count > 1 %}
      <div id="div_location" class="form-floating mb-3 col-auto">
        <select name="location" class="form-select" id="location">
          <option value="">{% trans "All locations" %}</option>
          {% for location in locations %}
            <option value="{{ location.slug }}"
                    {% if request.GET.location == location.slug %}selected{% endif %}>
              {{ location.name }} ({{ location.address }})
            </option>
          {% endfor %}
        </select>
        <label for="location">{% trans "Location" %}</label>
      </div>
    {% endif %}
    <div id="spinner"
         class="spinner-border col-auto htmx-indicator"
         role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </form>
  <div id="resource-list">
    {% partialdef resource-list inline %}
    {% for resource in resources %}
      <div class="card mb-3">
        <div class="row g-0">
          <div class="col-md-2">
            {% with resource.resourceimages_of_resource.all.0.image.url as img_url %}
              {% if img_url %}
                <img src="{{ img_url }}"
                     class="img-fluid rounded-start"
                     alt="{{ resource.name }}" />
              {% else %}
                <img src="..." class="img-fluid rounded-start" alt="..." />
              {% endif %}
            {% endwith %}
          </div>
          <div class="col-md-5">
            <div class="card-body">
              <h5 class="card-title">
                <a href="{% url 'resources:show-resource' resource_slug=resource.slug %}">{{ resource.name }}</a>
              </h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <svg class="fs-4 me-1" width="1em" height="1em">
                    <use href="#bi-people" />
                  </svg>
                  Max. {{ resource.max_persons }} {% trans "Persons" %} ({{ resource.square_meters|default_if_none:"" }}m²)
                </li>
                <li class="list-group-item">
                  <svg class="fs-4 me-1" width="1em" height="1em">
                    <use href="#bi-calendar2-check" />
                  </svg>
                  {{ resource.bookable_times }}
                </li>
                <li class="list-group-item">
                  <svg class="fs-4 me-1" width="1em" height="1em">
                    <use href="#bi-geo-alt" />
                  </svg>
                  {% if resource.location %}{{ resource.location.address }}{% endif %}
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-5">
            <div class="card-body">
              <h5 class="card-title text-end">
                <a class="btn btn-sm btn-outline-primary"
                   href="{% url 'bookings:create-booking' %}?resource={{ resource.slug }}{% if selected_date %}&startdate={{ selected_date }}{% endif %}{% if selected_time %}&starttime={{ selected_time }}{% endif %}{% if selected_end_time %}&endtime={{ selected_end_time }}{% endif %}{% if request.GET.persons_count %}&attendees={{ request.GET.persons_count }}{% endif %}"
                   role="button">{% trans "buchen" %}</a>
              </h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <svg class="fs-4 me-1" width="1em" height="1em">
                    <use href="#bi-piggy-bank" />
                  </svg>
                  {% for compensation in resource.compensations_of_resource.all %}
                    {% if compensation.is_active %}
                      {% if compensation.hourly_rate %}
                        {{ compensation.hourly_rate }}€/h
                      {% else %}
                        {{ compensation.name }}
                      {% endif %}
                      {% if not forloop.last %}//{% endif %}
                    {% endif %}
                  {% endfor %}
                </li>
                <li class="list-group-item">
                  <svg class="fs-4 me-1" width="1em" height="1em">
                    <use href="#bi-easel2" />
                  </svg>
                  {{ resource.included_equipment }}
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      {% trans "No resource matches your filter." %}
    {% endfor %}
  {% endpartialdef %}
</div>
{% endblock content %}
